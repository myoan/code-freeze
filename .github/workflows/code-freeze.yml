name: Code Freeze

on:
  workflow_dispatch:

jobs:
  code-freeze:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Toggle ruleset status
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          RULESET_ID=9484409

          # Get current ruleset status
          CURRENT_STATUS=$(gh api repos/${{ github.repository }}/rulesets/$RULESET_ID --jq '.enforcement')
          echo "Current status: $CURRENT_STATUS"

          # Toggle status
          if [ "$CURRENT_STATUS" = "active" ]; then
            NEW_STATUS="disabled"
            echo "Disabling ruleset..."
          else
            NEW_STATUS="active"
            echo "Enabling ruleset..."
          fi

          # Update ruleset
          gh api repos/${{ github.repository }}/rulesets/$RULESET_ID \
            -X PUT \
            -f enforcement=$NEW_STATUS

          echo "Ruleset status changed to: $NEW_STATUS"
